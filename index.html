<!DOCTYPE html>
<html>
  <head id="header">
    <title>Solar Potentials</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0i4PbgUe8ePbuuYLV6Ieb192cZuVt-uo&libraries=drawing"></script>
    <style>
        #map {
            height: 800px;
            width: 100%;
        }
    </style>
  </head>
  <body>
    <div id="map"></div>
        <script type="text/typescript">
            class Map {
                private _map: google.maps.Map = null;
                private _drawingManager: google.maps.drawing.DrawingManager = null;
                private const _filtersColor: string[] = ['white', 'red', 'orange', 'yellow', 'gray'];


                // -- Accesseurs --][
                public getMap(): google.maps.Map {
                    return this._map;
                }
                private setMap(map: google.maps.Map) {
                    this._map = map;
                }
                public getDrawingManager(): google.maps.drawing.DrawingManager {
                    return this._drawingManager;
                }
                private setDrawingManager(drawingManager: google.maps.drawing.DrawingManager) {
                    this._drawingManager = drawingManager;
                }
                // -- Accesseurs -- []

                constructor () {
                    // Initialize the map
                    this._map = new google.maps.Map(document.getElementById('map'), {
                                                        center: {lat: 6.065432, lng: 24.011209},
                                                        zoom: 4,
                                                        scaleControl: true,
                                                        streetViewControl: false
                                                });


                    // Initialize the drawing manager
                    this._drawingManager = new google.maps.drawing.DrawingManager({
                                                drawingControl: true,
                                                drawingControlOptions: {
                                                    position: google.maps.ControlPosition.TOP_CENTER,
                                                    drawingModes: ['polyline', 'polygon', 'rectangle', 'circle']
                                                },
                                                polylineOptions: {
                                                    strokeWeight: 0,
                                                    fillOpacity: 0.45,
                                                    editable: true
                                                },
                                                polygonOptions: {
                                                    strokeWeight: 0,
                                                    fillOpacity: 0.45,
                                                    editable: true
                                                },
                                                rectangleOptions: {
                                                    strokeWeight: 0,
                                                    fillOpacity: 0.45,
                                                    editable: true
                                                },
                                                circleOptions: {
                                                    strokeWeight: 0,
                                                    fillOpacity: 0.45,
                                                    editable: true
                                                },
                                                map: this._map
                                            });
                }

                // Here I choose 2 values of Solar Potential 1900 and 2100 to classify my datas
                private showAllSolarPotentials () {
                    this._map.data.setStyle((feature) => {
                        var color: string = null;
                        var solarPotential: number = feature.getProperty('ghi_kwh_m2');

                        if (solarPotential < 1900) {
                            color = this._filtersColor[1];
                        }
                        if (solarPotential >= 1900 && solarPotential < 2100){
                            color = this._filtersColor[2];
                        }
                        if (solarPotential >= 2100) {
                            color = this._filtersColor[3];
                        }

                        return ({
                                fillColor: color,
                                strokeColor: color,
                                strokeWeight: 0
                            })
                    });
                }

                private hideAllSolarPotentials () {
                    this._map.data.setStyle((feature) => {
                        return ({visible: false});
                    });
                }

                private addButtonControl(controlDiv, name: string, desc: string) {

                    // Getting the color
                    var color = this._filtersColor[controlDiv.index];

                    // Set CSS styles for the DIV containing the control
                    controlDiv.style.padding = '12px';

                    // Set CSS for the control border
                    var controlUI = document.createElement('div');
                    controlUI.style.backgroundColor = 'white';
                    controlUI.style.borderStyle = 'solid';
                    controlUI.style.borderWidth = '2px';
                    controlUI.style.cursor = 'pointer';
                    controlUI.style.textAlign = 'center';
                    controlUI.title = desc;
                    controlDiv.appendChild(controlUI);

                    // Set CSS for the control text
                    var controlText = document.createElement('div');
                    controlText.id = 'buttonControl' + color;
                    controlText.style.fontFamily = 'Arial,sans-serif';
                    controlText.style.fontSize = '12px';
                    controlText.style.paddingLeft = '4px';
                    controlText.style.paddingRight = '4px';
                    controlText.style.backgroundColor = color;
                    controlText.innerHTML = name;
                    controlUI.appendChild(controlText);

                    // Setup the click event listener on the buttons
                    google.maps.event.addDomListener(controlUI, 'click', (event) => {
                        switch (event.srcElement.id) {
                            case 'buttonControlyellow': {
                                this._map.data.setStyle((feature) => {
                                    return (feature.getProperty('ghi_kwh_m2') >= 2100) ? ({
                                                                                            fillColor: color,
                                                                                            strokeColor: color,
                                                                                            strokeWeight: 0
                                                                                        }) : ({visible: false});
                                });
                                break;
                            }
                            case 'buttonControlorange': {
                                this._map.data.setStyle((feature) => {
                                    return ((feature.getProperty('ghi_kwh_m2') >= 1900) && (feature.getProperty('ghi_kwh_m2') < 2100) ? ({
                                                                                                fillColor: color,
                                                                                                strokeColor: color,
                                                                                                strokeWeight: 0
                                                                                            }) : ({visible: false});
                                });
                                break;
                            }
                            case 'buttonControlred': {
                                this._map.data.setStyle((feature) => {
                                        return (feature.getProperty('ghi_kwh_m2') < 1900) ? ({
                                                                                                fillColor: color,
                                                                                                strokeColor: color,
                                                                                                strokeWeight: 0
                                                                                            }) : ({visible: false});
                                });
                                break;
                            }
                            case 'buttonControlwhite': {
                                this.showAllSolarPotentials();
                                break;
                            }
                            case 'buttonControlgray': {
                                this.hideAllSolarPotentials();
                                break;
                            }
                        }
                    });
                }

                public initButtons () {
                    // Filter buttons
                    var filterButtonAll = document.createElement('div');
                    var filterButtonYellow = document.createElement('div');
                    var filterButtonOrange = document.createElement('div');
                    var filterButtonRed = document.createElement('div');
                    var filterButtonHide = document.createElement('div');

                    filterButtonAll.index = 0;
                    filterButtonRed.index = 1;
                    filterButtonOrange.index = 2;
                    filterButtonYellow.index = 3;
                    filterButtonHide.index = 4;

                    this.addButtonControl(filterButtonAll, 'All SP (kwh/m²)', 'Click to show all solar potentials datas');
                    this.addButtonControl(filterButtonRed, 'SP < 1900', 'Click to show only solar potentials under 1900');
                    this.addButtonControl(filterButtonOrange, '1900 <= SP < 2100', 'Click to show only solar potentials between 1900 and 2100');
                    this.addButtonControl(filterButtonYellow, 'SP >= 2100', 'Click to show only solar potentials over 2100');
                    this.addButtonControl(filterButtonHide, 'Hide', 'Click to Hide all solar potentials datas');

                    this._map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(filterButtonAll);
                    this._map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(filterButtonRed);
                    this._map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(filterButtonOrange);
                    this._map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(filterButtonYellow);
                    this._map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(filterButtonHide);
                }

                private loadGeoJsonString(geoString) {
                    var geojson =JSON.parse(geoString);
                    this._map.data.addGeoJson(geojson);
                    zoom(this._map);
                }

                public init() {
                    // Assign the drawing manager to the map
                    this._drawingManager.setMap(this._map);

                    // Load GeoJson file
                    this._map.data.loadGeoJson('./datas/data.geojson');

                    // Show datas with solar potential levels
                    this.showAllSolarPotentials();

                    // Add the listners to our buttons
                    google.maps.event.addDomListener(window, 'init', this.initButtons());
                }
            }

            // Creating an instance of Map
            var myMap: Map = new Map();

            // Initilize the map
            myMap.init();
        </script>




    <script type="text/javascript" src="./scripts/ts_compiler/typescript.min.js"></script>
    <script type="text/javascript" src="./scripts/ts_compiler/typescript.compile.min.js"></script>
  </body>
</html>
